{
  "hash": "817a4fe2f3ed9be391c0786cbb4bc402",
  "result": {
    "markdown": "---\ntitle: \"Example in `inlabru`\"\nexecute: \n  freeze: true\nknitr:\n  opts_chunk: \n    message: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(INLA)\nlibrary(inlabru)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninla.setOption(num.threads = \"1:1\")\n```\n:::\n\n\nWe here show how to fit the measurement error and missing data model in `inlabru`. The `inlabru` code is written by Sara Martino, and commented by Emma Skarstein.\n\n\n## Loading the data\nFor this demonstration we will use the simulated data from the [Simulation example](simulation_example.qmd). Just to refresh: this is a situation where we have one covariate ($\\boldsymbol{x}$) that has both classical  error, Berkson error and missing data. We also observe another covariate ($\\boldsymbol{z}$) that has no error.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read.csv(\"data/simulated_data.csv\")\nn <- nrow(data)\n```\n:::\n\n\n## Priors\nWe use the exact same priors as in the original simulation study.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Priors for model of interest coefficients\nprior.beta = c(0, 1/1000) # N(0, 10^3)\n\n# Priors for exposure model coefficients\nprior.alpha <- c(0, 1/10000) # N(0, 10^4) \n\n# Priors for y, measurement error and true x-value precision\nprior.prec.y <- c(10, 9) # Gamma(10, 9)\nprior.prec.u_b <- c(10, 9) # Gamma(10, 9)\nprior.prec.u_c <- c(10, 9) # Gamma(10, 9)\nprior.prec.r <- c(10, 9) # Gamma(10, 9) \n\n\n# Initial values\nprec.y <- 1\nprec.u_b <- 1\nprec.u_c <- 1\nprec.r <- 1\n```\n:::\n\n\n## Specifying the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Regression model of interest \ndata_moi <- data.frame(y = data$y, z = data$z, weight.x = 1, weight.r = 1, r = 1:n) \n\n# Berkson ME model\ndata_berkson <- data.frame(zero = 0, weight.x = -1, weight.r = 1, r = 1:n) \n\n# Classical ME model\ndata_classical <- data.frame(w = data$w, weight.x = 1, weight.r = 1, r = 1:n)\n\n# Imputation model\ndata_imputation <- data.frame(zero = 0, z = data$z, weight.x = 1, weight.r = -1, r = 1:n)\n```\n:::\n\n\n## Formulas\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncmp_new <- ~ Intercept(1, model = \"linear\", prec.linear = prior.beta[2]) +\n  beta_z(main = z, model = \"linear\", prec.linear = prior.beta[2]) +\n  x_eff(r, weight.x, model = \"iid\",  hyper = list(prec = list(initial = -15, fixed=TRUE))) +\n  x_eff_copy(r, copy=\"x_eff\", hyper = list(beta = list(param = prior.beta, fixed=FALSE))) +\n  r_eff(r, weight.r, model = \"iid\",  hyper = list(prec = list(initial = -15, fixed=TRUE))) +\n  alpha_0(main = 1, model = \"linear\", prec.linear = prior.alpha[2]) +\n  alpha_z(main = z, model = \"linear\", prec.linear = prior.alpha[2])\n\n\nlik_moi <- like(formula = y ~ .,\n                family = \"gaussian\",\n                include = c(\"Intercept\", \"beta_z\", \"x_eff_copy\"),\n                control.family = list(\n                  hyper = list(prec = list(initial = log(prec.y), \n                                           param = prior.prec.y, \n                                           fixed = FALSE))),\n            data = data_moi)\n\nlik_berkson <- like(formula = zero ~ .,\n                    family = \"gaussian\",\n                    include = c(\"x_eff\", \"r_eff\"),\n                    control.family = list(\n                      hyper = list(prec = list(initial = log(prec.u_b),\n                                               param = prior.prec.u_b,\n                                               fixed = FALSE))),\n                    data = data_berkson)\n\nlik_classical <- like(formula = w ~ .,\n                      family = \"gaussian\",\n                      include = c(\"r_eff\"),\n                      control.family =  list(\n                        hyper = list(prec = list(initial = log(prec.u_c), \n                                                 param = prior.prec.u_c, \n                                                 fixed = FALSE))),\n            data  = data_classical)\n\nlik_imputation <- like(formula = zero ~ .,\n                       family = \"gaussian\",\n                       include = c(\"alpha_0\", \"alpha_z\",\"r_eff\"),\n                       control.family =   list(\n                         hyper = list(prec = list(initial = log(prec.r), \n                                                  param = prior.prec.r, \n                                                  fixed = FALSE))),\n             data = data_imputation)\n```\n:::\n\n\n## Fitting the model\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1)\nbru_options_set(bru_verbose = 1)\nfit <- bru(components = cmp_new,\n           lik_moi,\n           lik_berkson,\n           lik_classical,\n           lik_imputation,\n           options = list(verbose = F,\n                          bru_max_iter = 20,\n                          inla.mode  = \"experimental\"))\nfit$summary.fixed\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               mean         sd 0.025quant 0.5quant 0.975quant      mode\nIntercept 0.8721304 0.21550848  0.4541020 0.871074   1.287567 0.8589377\nbeta_z    1.8124232 0.38688083  1.0818672 1.807293   2.521267 1.8093987\nalpha_0   1.0053008 0.04730920  0.9125035 1.005299   1.098107 1.0052961\nalpha_z   1.9876659 0.04890406  1.8917528 1.987660   2.083613 1.9876481\n                   kld\nIntercept 9.864355e-08\nbeta_z    1.060705e-04\nalpha_0   2.480212e-13\nalpha_z   1.764021e-12\n```\n:::\n\n```{.r .cell-code}\nfit$summary.hyperpar\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                               mean        sd 0.025quant\nPrecision for the Gaussian observations    1.132957 0.3370441  0.5915890\nPrecision for the Gaussian observations[2] 1.149355 0.3109069  0.6518148\nPrecision for the Gaussian observations[3] 1.097527 0.1283043  0.8678630\nPrecision for the Gaussian observations[4] 1.022813 0.1176202  0.8090784\nBeta for x_eff_copy                        2.078453 0.1889701  1.7011582\n                                           0.5quant 0.975quant     mode\nPrecision for the Gaussian observations    1.093320   1.907688 1.019171\nPrecision for the Gaussian observations[2] 1.111328   1.869352 1.039991\nPrecision for the Gaussian observations[3] 1.089503   1.373191 1.072757\nPrecision for the Gaussian observations[4] 1.016694   1.272363 1.005424\nBeta for x_eff_copy                        2.080213   2.446667 2.086862\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}